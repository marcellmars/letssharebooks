<!DOCTYPE html>
<html lang="en">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# books: http://ogp.me/ns/books#">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MEMORY OF THE WORLD</title>
    <link rel="stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="static/style.css" />
  </head>
  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand hidden-lg" href="#">
            <img id="home" class="home-link" alt="motw home" src="static/motw.ico" />
          </a>
          <p class="navbar-text home-link home-text hidden-xs">LIBRARY</p>
          <p class="navbar-text" id="num-books"></p>
        </div>
        <div class="navbar-right hidden-xs widget-title">
          <a href="https://www.memoryoftheworld.org" target="_blank">MEMORY OF THE WORLD</a>
        </div>
      </div>
    </nav>

    <nav class="navbar navbar-search">
      <div class="container">

        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>

        <div class="collapse navbar-collapse" id="navbar">

          <form class="navbar-form">

            <div class="form-group">
              <select id="property" class="form-control input-sm">
                <option value="authors">Authors</option>
                <option value="title">Title</option>
                <option value="all">All metadata</option>
              </select>
            </div>

            <div class="form-group">
              <input  id="text" type="text" class="form-control input-sm" placeholder="type here...">
            </div>
            
            <div class="form-group">
              <select id="librarian" class="form-control input-sm"></select>
            </div>

            <button id="search" type="submit" class="btn btn-default btn-sm">SEARCH</button>
          </form>
          
        </div>
      </div>
    </nav>

    <div id="content" class="container"></div>
    <div id="load-more">
      <div class="container">
        <input class="btn btn-default btn-lg btn-block" type="button" value="LOAD MORE">
      </div>
    </div>

    <div id="modal" class="modal fade" role="dialog" tabindex="-1" aria-labelledby="book-modal-label"></div>
    
  </body>

  <script type="text/x-template" id="book-content-tmpl">
    <div class="col col-sm-4 col-md-3">
      <div class="cover" rel='<%= book.librarian %>'>

        <a href="#" class="more_about" rel='<%= book.uuid %>' title="about this book">
          <img class="cover-grid" src="<%= book.cover_url %>" />
          <div class="cover-highlight">
            <span class="hmsg">Shared by <%= book.librarian %></span>
          </div>
        </a>

        <h2>
          <a href="#" class="more_about" rel='<%= book.uuid %>'
             title="about this book"><%= book.title %></a>
          
          <div id="authors">
            <% for( var i = 0; i < book.authors.length; i++ ) { %>
               <% var author = book.authors[i]; var author_s = author.replace("'", " "); %>
               <a class="author" data-authors="<%- author_s %>" href="#" data-toggle="tooltip" data-placement="bottom" title="show only books by <%- author_s %>"><%- author %></a>
               <% } %>
          </div>
        </h2>
        
        <% if (book.formats[0] != '0') { %>
        <span class="download">Download:
          <% for( var i = 0; i < book.formats.length; i++ ) { %>
             <% var format = book.formats[i] %>
             <a href="<%= book.prefix_url + book.format_metadata[format].file_path %>"><%= format.toUpperCase() %></a>
             <% } %>
        </span>
        <% } %>
        
        <% if (localCalibre.showImportLinks(book.library_uuid)) { %>
        <a href="http://127.0.0.1:56665/?urls=<%= metadata_urls %>" class="import-to-calibre" data-toggle="tooltip" data-placement="bottom"
           title="import book directly to calibre" target="import">
          <img class="lodestone" src="static/lodestone.png" />
        </a>
        <% } %>        
      </div>
    </div>
  </script>

  <script type="text/x-template" id="book-modal-tmpl">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title"><%= book.title %></h4>
        </div>
        <div class="modal-body">
          <div id="book-modal" class="book-modal" title="<%= book.title %>">
            <div class="lodestone_modal">
              <a href="/b/<%= book.uuid %>">
                <img class="cover-modal" src="<%= book.cover_url %>" />
              </a>
              <% if (localCalibre.showImportLinks(book.library_uuid)) { %>
              <a href="http://127.0.0.1:56665/?urls=<%= metadata_urls %>" class="import-to-calibre" data-toggle="tooltip" data-placement="bottom"
                 title="import book directly to calibre" target="import">
                <img src="static/lodestone_modal.png" />
              </a>
              <% } %>
            </div>
            <p><span class="attr">Title:</span> 
              <a class="title" href="/b/<%= book.uuid %>"><%= book.title %></a></p>
            <p><span class="attr">Authors:</span> <%= book.authors %></p>
            <p><span class="attr">Publisher:</span> <%= book.publisher %></p> 
            <% if (book.formats[0] != '0') { %>
            <p><span class="attr">Download:</span> 
              <% for( var i = 0; i < book.formats.length; i++ ) { %>
                 <% var format = book.formats[i] %>
                 <a href="<%= book.prefix_url + book.format_metadata[format].file_path %>"><%= format.toUpperCase() %></a>
                 <% } %>
            </p>
            <% } %>
            <p><span class="attr">About:</span> <%= book.comments %></p></br>
            <p><a href="<%= book.prefix_url %>" target="_blank">Browse only <%= book.librarian %>'s library</a></p></br>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </script>

  <script type="text/x-template" id="import-modal-tmpl">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Importing to calibre</h4>
        </div>
        <div class="modal-body">
          <p>Check [let's share books] plugin in your Calibre for downloads...</p>
        </div>
      </div>
    </div>
  </script>

  <script type="application/javascript" src="static/underscore-min.js"></script>
  <script type="application/javascript" src="static/jquery-1.10.2.min.js"></script>
  <script type="application/javascript" src="static/jquery-migrate-1.2.1.js"></script>
  <script type="application/javascript" src="static/jquery.ba-bbq.min.js"></script>
  <script type="application/javascript" src="static/bootstrap/js/bootstrap.min.js"></script>
  <script type="application/javascript" src="static/typeahead.bundle.min.js"></script>

  <script type="application/javascript" src="static/json2.js"></script>
  <script type="application/javascript" src="static/data.js"></script>
  <script type="application/javascript" src="static/portable.js"></script>
  <script type="application/javascript" src="static/common.js"></script>
  <script type="application/javascript" src="static/local_calibre.js"></script>
  <script type="application/javascript" src="static/libraries.js"></script>
</html>
