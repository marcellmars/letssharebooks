server {
        listen 80;
        listen [::]:80;
        # listen 443 ssl spdy;
        # listen [::]:443 ssl spdy;

        server_name couchdb.javnaknjiznica.org;

         # add_header Strict-Transport-Security max-age=31536000;

        # ssl_certificate /etc/ssl/certs/lsb_domain.crt;
        # ssl_certificate_key /etc/ssl/private/lsb_domain.key;

        location /db/ {
              proxy_hide_header Access-Control-Allow-Origin;
              if ($request_method = 'OPTIONS') {
                      add_header 'Access-Control-Allow-Headers' 'Content-Type,Accept';
                      add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, COPY, DELETE';
                      add_header 'Access-Control-Allow-Credentials' 'true' always;
                      add_header "Access-Control-Allow-Origin" $http_origin always;
                      add_header "Access-Control-Allow-Headers" "X-Requested-With";
                      add_header "Access-Control-Allow-Headers" "User-Agent";
                      add_header "Access-Control-Allow-Headers" "Origin";
                      return 200;
              }
              add_header 'Allow' 'GET, POST, OPTIONS, PUT, COPY, DELETE';
              add_header 'Access-Control-Allow-Headers' 'Content-Type,Accept';
              add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, COPY, DELETE';
              add_header 'Access-Control-Allow-Credentials' 'true' always;
              add_header 'Access-Control-Allow-Origin' '$http_origin' always;
              add_header "Access-Control-Allow-Headers" "X-Requested-With";
              add_header "Access-Control-Allow-Headers" "User-Agent";
              add_header "Access-Control-Allow-Headers" "Origin";

              proxy_pass http://couchdb:5984;

              proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
              proxy_redirect off;
              proxy_buffering off;
              proxy_set_header        Host            $host;
              proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;

              rewrite /db(.*) $1 break;

}


        access_log /var/log/nginx/couchdb.javnaknjiznica.org-access.log;
        error_log /var/log/nginx/couchdb.javnaknjiznica.org-error.log;
}
