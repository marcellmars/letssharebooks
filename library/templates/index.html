{% extends "base.html" %}

{% block header %}
<nav class="navbar navbar-default">
  <div class="container-fluid">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">
        <img id="home" alt="motw home" src="/static/motw.ico">
      </a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input id="authors" type="text" class="form-control" placeholder="authors">
          <input id="titles" type="text" class="form-control" placeholder="titles">
          <input id="search_all" type="text" class="form-control" placeholder="all metadata">
          <select id="librarian" class="form-control"></select>
        </div>
      </form>

      <ul class="navbar-form navbar-right">
        <button id="search" type="submit" class="btn btn-default">SEARCH</button>
      </ul>
      
    </div>
  </div>
</nav>

{% endblock %}

{% block content %}
<div id="content" class="container"></div>
<div id="load-more">
  <input class="btn btn-default" type="button" value="LOAD MORE">
</div>
<div class="modal"></div>
{% endblock %}

{% block templates %}
<script type="text/x-template" id="book-content-tmpl">
  <div class="col col-md-3">
    <div class="cover" rel='<%= book.librarian %>'>

      <a href="#" class="more_about" rel='<%= book.uuid %>' title="about this book">
        <img class="cover-grid"
             src="<%= book.cover_url %>" />
        <div class="cover-highlight">
          <span class="hmsg">Shared by <%= book.librarian %></span>
        </div>
      </a>

      <h2>
        <a href="#" class="more_about" rel='<%= book.uuid %>' title="about this book"><%= book.title %></a>
        <br />
        <div id="authorz">
          <% for( var i = 0; i < book.authors.length; i++ ) { %>
             <% var author = book.authors[i]; var author_s = author.replace("'", " "); %>
             <a class="author" data-authors="<%- author_s %>" href="#"
                title="show only books by <%- author_s %>"><%- author %></a>
             <% } %>
        </div>
      </h2>
      
      <% if (book.formats[0] != '0') { %>
      <span class="download">Download:
        <% for( var i = 0; i < book.formats.length; i++ ) { %>
           <% var format = book.formats[i] %>
           <a href="<%= book.prefix_url + book.format_metadata[format].file_path %>"><%= format.toUpperCase() %></a>
           <% } %>
      </span>
      <% } %>
      
      <% if (localCalibre.showImportLinks(book.library_uuid)) { %>
      <a href="http://127.0.0.1:56665/?urls=<%= metadata_urls %>" class="import"
         title="import book directly to calibre" target="import">
        <span class="lodestone">
          <img src="/images/lodestone.png" title="import book directly to calibre" />
        </span>
      </a>
      <% } %>
      
    </div>
  </div>
</script>

<script type="text/x-template" id="book-modal-tmpl">
  <div id="book-modal" class="book-modal" title="<%= book.title %>">
    <div>
      <a href="/b/<%= book.uuid %>">
        <img class="cover-modal" src="<%= book.cover_url %>" />
      </a>
      <% if (localCalibre.showImportLinks(book.library_uuid)) { %>
      <a href="http://127.0.0.1:56665/?urls=<%= metadata_urls %>" class="import"
         title="import book directly to calibre" target="import">
        <span class="lodestone_modal">
          <img src="/images/lodestone_modal.png" title="import book directly to calibre" />
        </span>
      </a>
      <% } %>
    </div>
    <p><span class="attr">Title:</span> 
      <a class="title" href="/b/<%= book.uuid %>"><%= book.title %></a></p>
    <p><span class="attr">Authors:</span> <%= book.authors %></p>
    <p><span class="attr">Publisher:</span> <%= book.publisher %></p> 
    <% if (book.formats[0] != '0') { %>
    <p><span class="attr">Download:</span> 
      <% for( var i = 0; i < book.formats.length; i++ ) { %>
        <% var format = book.formats[i] %>
        <a href="<%= book.prefix_url + book.format_metadata[format].file_path %>"><%= format.toUpperCase() %></a>
      <% } %>
    </p>
    <% } %>
    <p><span class="attr">About:</span> <%= book.comments %></p></br>
    <p><a href="<%= book.prefix_url %>" target="_blank">Browse only <%= book.librarian %>'s library</a></p></br>
  </div>
</script>

<script type="text/x-template" id="import-modal-tmpl">
  <div id="import-modal" title="Importing to calibre">
    <div>
      <p>Check [let's share books] plugin in your Calibre for downloads...</p>
    </div>
  </div>
</script>
{% endblock %}

{% block scripts %}
<script type="application/javascript" src="/static/libraries.js"></script>
{% endblock %}
